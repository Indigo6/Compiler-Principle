# Report of Code Generation Lab
江学强 PB16120100

## 实验思路

实验思路与上课讲的三地址码的生成几乎相同，下面只叙述我做的一些工作。

## 一些细节

do while 语句的翻译： 由于是自顶向下的分析方式，所以实现do while很简单，我们的产生式是 do statement while condition
所以我在分析翻译statement之前先记录下行号（目前已经生成的汇编代码的行号），之后再翻译晚condition之后JPC这一地址即可，因为condition执行完，执行栈顶就是condition结果的bool值。


符号表的维护和检索:我们符号表作用域的维护主要用level字段来实现的，这样实现起来简单，但是功能有限，真正完善的符号表应该按照课上讲的方式

参数传递和返回值的翻译，参数是压入栈传递，调用函数时，先把函数的返回地址压栈，之后把参数压栈，返回值的实现也是通过栈，需要说明的一点是为了实现的统一，不管函数有无返回值，我也会在函数代码段的结尾往栈中压进一个默认的返回值。
这么做的可行性是如果函数有返回值，则在正常的return语句已经jmp回调用函数，后面生成的默认代码不会被执行，当函数没有返回值的时候这段默认代码才会执行。
这么做的好处是，调用函数之后，栈顶一定是返回值（真的返回值或默认的返回值），这样调用函数段可以更同意的生成代码。

此外为了debug的方便，我自己实现了一个执行汇编代码的程序来帮我们迅速找到bug，这是因为助教给的程序只能看到最终的分数看不到哪些testcase出错了，为了方便debug自己实现了一个模拟器。


## 总结

我们小组写实验都是一起约时间约地点写然后一起debug，工作量基本相当。
lab4比之前的实验要有趣一些，debug跑分的过程也很有意思。